#!/bin/sh
#======================================================================
# FILE:		compile_html
# AUTHOR:	Craig A. James
# DESCRIPTION:
#	The HTML "man" pages files are derived from ".mansrc" files.
#	There are hundreds of files, and i t is nearly impossible
#	to maintain a proper Makefile for so many files.
#
#	This shell script generates a throw-away makefile each time
#	it is run, which generates the dependencies automatically.
#	It then runs the makefile, and which finished discards it.
#
#	It takes one parameter: The name of the "compile" program
#	that converts a .mansrc files to a .html file.  All files named
#	"*.mansrc" are converted.
#	
# Copyright (c) 1995, Daylight Chemical Information Systems, Inc.
#======================================================================

if [ $# != 1 ] ; then
  echo "usage: $0 convert-program"
  exit 1;
fi

myname=`basename $0`
convert=$1
makefile=Makefile$$

systype=`$DY_ROOT/toolsrc/unix_osversion`
version=`echo $systype | awk '{print $2}'`
systype=`echo $systype | awk '{print $1}'`

case $systype in
    sun)     CP=/usr/bin/cp; CHMOD=/usr/bin/chmod; RM="/usr/bin/rm" ;;
    solaris) CP=/usr/bin/cp; CHMOD=/usr/bin/chmod; RM="/usr/bin/rm" ;;
    sgi)     CP=/bin/cp;     CHMOD=/bin/chmod;     RM="/bin/rm"  ;;
    hp)      CP=/bin/cp;     CHMOD=/bin/chmod;     RM="/bin/rm"  ;;
    next)    CP=/bin/cp;     CHMOD=/bin/chmod;     RM="/bin/rm"  ;;
    *)
	echo "$0: ERROR: Unknown OS"
	echo "    UNIX OS type is \"$systype\"; never heard of it."
	echo "    You have to modify me before I'll work on this machine."
	echo ""
	exit 1
	 ;;
esac
export CP CHMOD RM

echo $myname: `pwd`

(
echo "# Automatically generated by $0."
echo "# It should have been removed, too!"
echo "install::"

for f in *.mansrc ; do
  base=`basename $f .mansrc`
  echo "install:: $base.html"
  echo "$base.html: $f"
  echo "	$convert $f html"
  echo ""
done

) >$makefile

make -f $makefile install

rm $makefile
